VERSION 5.00
Object = "{7D622DE6-0ABC-471E-9234-97DEC5E0A708}#3.8#0"; "sevCmd3.ocx"
Begin VB.Form frmWKL60 
   BackColor       =   &H00C0FFFF&
   Caption         =   "Achtung!"
   ClientHeight    =   8595
   ClientLeft      =   60
   ClientTop       =   345
   ClientWidth     =   11880
   ControlBox      =   0   'False
   Icon            =   "frmWKL60.frx":0000
   LinkTopic       =   "Form1"
   MaxButton       =   0   'False
   MinButton       =   0   'False
   ScaleHeight     =   8595
   ScaleWidth      =   11880
   StartUpPosition =   2  'Bildschirmmitte
   Begin sevCommand3.Command Command5 
      Height          =   495
      Index           =   2
      Left            =   9000
      TabIndex        =   5
      Top             =   5880
      Width           =   2655
      _ExtentX        =   4683
      _ExtentY        =   873
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BeginProperty MenuFont {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BackColorDisabled=   15398133
      BackColorFrom   =   16514300
      BackColorTo     =   15462640
      BackColorCheckedFrom=   15462640
      BackColorCheckedTo=   16514300
      BackColorDownFrom=   12700881
      BackColorDownTo =   15659506
      BackColorHoverFrom=   16514300
      BackColorHoverTo=   15462640
      BorderColor     =   7617536
      BorderColorDisabled=   12240841
      BorderColorFocus=   14986635
      BorderColorHover=   3913721
      ForeColorDisabled=   9609633
      MenuBackColor   =   16448250
      MenuBackColorChecked=   7323903
      MenuBackColorHover=   10935807
      MenuBorderColor =   8388608
      MenuCheckMarkColorFrom=   16514300
      MenuCheckMarkColorTo=   15462640
      MenuForeColor   =   -2147483640
      MenuForeColorHover=   -2147483640
      ButtonStyle     =   2
      Caption         =   "Notfall Kasse"
      PictureAlign    =   2
      PictureVisible  =   0   'False
      Version3        =   -1  'True
   End
   Begin sevCommand3.Command Command5 
      Height          =   495
      Index           =   3
      Left            =   9000
      TabIndex        =   4
      Top             =   7680
      Width           =   2655
      _ExtentX        =   0
      _ExtentY        =   0
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BeginProperty MenuFont {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BackColorDisabled=   15398133
      BackColorFrom   =   16514300
      BackColorTo     =   15462640
      BackColorCheckedFrom=   15462640
      BackColorCheckedTo=   16514300
      BackColorDownFrom=   12700881
      BackColorDownTo =   15659506
      BackColorHoverFrom=   16514300
      BackColorHoverTo=   15462640
      BorderColor     =   7617536
      BorderColorDisabled=   12240841
      BorderColorFocus=   14986635
      BorderColorHover=   3913721
      ForeColorDisabled=   9609633
      MenuBackColor   =   16448250
      MenuBackColorChecked=   7323903
      MenuBackColorHover=   10935807
      MenuBorderColor =   8388608
      MenuCheckMarkColorFrom=   16514300
      MenuCheckMarkColorTo=   15462640
      MenuForeColor   =   -2147483640
      MenuForeColorHover=   -2147483640
      ButtonStyle     =   2
      Caption         =   "Winkiss beenden"
      PictureAlign    =   2
      PictureVisible  =   0   'False
      Version3        =   -1  'True
   End
   Begin sevCommand3.Command Command5 
      Height          =   495
      Index           =   1
      Left            =   9000
      TabIndex        =   2
      Top             =   6480
      Width           =   2655
      _ExtentX        =   0
      _ExtentY        =   0
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BeginProperty MenuFont {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BackColorDisabled=   15398133
      BackColorFrom   =   16514300
      BackColorTo     =   15462640
      BackColorCheckedFrom=   15462640
      BackColorCheckedTo=   16514300
      BackColorDownFrom=   12700881
      BackColorDownTo =   15659506
      BackColorHoverFrom=   16514300
      BackColorHoverTo=   15462640
      BorderColor     =   7617536
      BorderColorDisabled=   12240841
      BorderColorFocus=   14986635
      BorderColorHover=   3913721
      ForeColorDisabled=   9609633
      MenuBackColor   =   16448250
      MenuBackColorChecked=   7323903
      MenuBackColorHover=   10935807
      MenuBorderColor =   8388608
      MenuCheckMarkColorFrom=   16514300
      MenuCheckMarkColorTo=   15462640
      MenuForeColor   =   -2147483640
      MenuForeColorHover=   -2147483640
      ButtonStyle     =   2
      Caption         =   "Protokoll"
      PictureAlign    =   2
      PictureVisible  =   0   'False
      Version3        =   -1  'True
   End
   Begin sevCommand3.Command Command5 
      Height          =   495
      Index           =   0
      Left            =   9000
      TabIndex        =   0
      Top             =   7080
      Width           =   2655
      _ExtentX        =   0
      _ExtentY        =   0
      BeginProperty Font {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BeginProperty MenuFont {0BE35203-8F91-11CE-9DE3-00AA004BB851} 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   700
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      BackColorDisabled=   15398133
      BackColorFrom   =   16514300
      BackColorTo     =   15462640
      BackColorCheckedFrom=   15462640
      BackColorCheckedTo=   16514300
      BackColorDownFrom=   12700881
      BackColorDownTo =   15659506
      BackColorHoverFrom=   16514300
      BackColorHoverTo=   15462640
      BorderColor     =   7617536
      BorderColorDisabled=   12240841
      BorderColorFocus=   14986635
      BorderColorHover=   3913721
      ForeColorDisabled=   9609633
      MenuBackColor   =   16448250
      MenuBackColorChecked=   7323903
      MenuBackColorHover=   10935807
      MenuBorderColor =   8388608
      MenuCheckMarkColorFrom=   16514300
      MenuCheckMarkColorTo=   15462640
      MenuForeColor   =   -2147483640
      MenuForeColorHover=   -2147483640
      ButtonStyle     =   2
      Caption         =   "Weiter"
      PictureAlign    =   2
      Version3        =   -1  'True
   End
   Begin VB.Label Label3 
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   375
      Left            =   120
      TabIndex        =   7
      Top             =   960
      Width           =   9135
   End
   Begin VB.Label Label2 
      BackColor       =   &H00C0C0FF&
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   495
      Left            =   9840
      TabIndex        =   6
      Top             =   240
      Width           =   1815
   End
   Begin VB.Label Label1 
      Caption         =   "Label1"
      BeginProperty Font 
         Name            =   "Arial"
         Size            =   12
         Charset         =   0
         Weight          =   400
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      Height          =   3975
      Left            =   120
      TabIndex        =   3
      Top             =   1440
      Width           =   9135
   End
   Begin VB.Label lblUeberschrift 
      BackStyle       =   0  'Transparent
      Caption         =   "Achtung!"
      BeginProperty Font 
         Name            =   "Arial Black"
         Size            =   21.75
         Charset         =   0
         Weight          =   900
         Underline       =   0   'False
         Italic          =   0   'False
         Strikethrough   =   0   'False
      EndProperty
      ForeColor       =   &H00808000&
      Height          =   615
      Left            =   120
      TabIndex        =   1
      Top             =   120
      Width           =   9135
   End
   Begin VB.Line Line1 
      BorderColor     =   &H00808000&
      BorderWidth     =   2
      Index           =   0
      X1              =   120
      X2              =   11640
      Y1              =   840
      Y2              =   840
   End
End
Attribute VB_Name = "frmWKL60"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = False
Private Sub Command5_Click(index As Integer)
On Error GoTo LOKAL_ERROR

    Dim cPfad As String
    Dim ctemp As String
    Dim iRet As Integer
    
    cPfad = gcDBPfad
    If Right(cPfad, 1) <> "\" Then
        cPfad = cPfad & "\"
    End If
    
    

    
    Select Case index
        Case 0
        
            Select Case giUmleitgrund
                Case 1
                    
                Case 2 'daba rep
                
                   
                        cPfad = ShortPath(cPfad)
                        
                        If Datenbankreparatur(cPfad, "kissdata.mdb", gsPasswort, Label1, Label3) Then
                            Set gdBase = OpenDatabase(cPfad & "kissdata.mdb", False, False, "MS Access;PWD=" & gsPasswort)
                            MsgBox "Die Datenbank ist repariert, jetzt können alle anderen Winkiss/Kassenrechner weiterarbeiten.", vbInformation, "Winkiss Hinweis:"
                            
                        Else
                            
                        End If
                    
                    
                    
                Case 3
                
                Case 4 'Unbekannter Fehler
                    'schalte in lokalen Modus
                    
                
                Case 6
                    If repDbeinste Then
                        checktab "DBEINSTE", gdBase
                    Else
                        Label1.Caption = "Die verlorenen Datenbankinformationen konnten nicht wiederhergestellt werden." & vbCrLf
                        Label1.Caption = Label1.Caption & "Drücken Sie 'Winkiss beenden'!"
                        Exit Sub
                    
                    End If
                    
                    
                
            End Select
            
            Unload frmWKL60
            
            
        Case 1
            Screen.MousePointer = 11
            zeigeHilfeDabapfad "LPROTOK", "DBERRMEL.txt"
            Screen.MousePointer = 0
        Case 2
            Select Case giUmleitgrund
                Case 1

                Case 2
                    'schalte in lokalen Modus
                    schaltelokalmodus
                    

                Case 3
                
                Case 4 'Unbekannter Fehler
                    'schalte in lokalen Modus
                    schaltelokalmodus
                    
                Case 5 'Komp Fehler
                    'schalte in lokalen Modus
                    schaltelokalmodus
                
            End Select
            
            Unload frmWKL60
        
        Case 3
            Select Case giUmleitgrund
                
        
                Case 8 '429 ocx fehlt oder registri
                    Gemeindatcheck "DAO360.DLL", True
            End Select
            End
    End Select
    
    Exit Sub
LOKAL_ERROR:
    Fehler.gsDescr = err.Description
    Fehler.gsNumber = err.Number
    Fehler.gsFormular = Me.name
    Fehler.gsFunktion = "Command5_Click"
    Fehler.gsFehlertext = "Im Programmteil Datenbankfehler ist ein Fehler aufgetreten." & index & " " & giUmleitgrund
    
    Fehlermeldung1
    
End Sub
Private Sub schaltelokalmodus()
    On Error GoTo LOKAL_ERROR
    
    'globale Variable setzen
    gbLokalModus = True
    
    'lokal.cfg schreiben
    If gbLokalModus Then
        gcDBPfad = "C:\aLeer"
        iFileNr = FreeFile
        Open gcPfad & "Lokal.CFG" For Binary As #iFileNr
    
        If LOF(iFileNr) > 0 Then
            Close iFileNr
        Else
            ctemp = "Rechner befindet sich zur Zeit im lokalen Modus"
            Put #iFileNr, 1, ctemp
            Close iFileNr
        End If
    End If
    
    'aussehen verändern
    
    If gbLokalModus Then
        
        
        frmWKL00.Command1(0).Enabled = False
        frmWKL00.Command1(1).Enabled = True
        frmWKL00.Command1(2).Enabled = False
        frmWKL00.Command1(3).Enabled = False
        frmWKL00.Command1(4).Enabled = False
        frmWKL00.Command1(8).Enabled = False
        
        
        
        frmWKL00.Command3(7).Enabled = False
        frmWKL00.Command3(4).Enabled = False
        frmWKL00.Command3(5).Enabled = False
        
    Else
    
        frmWKL00.Command1(0).Enabled = True
        frmWKL00.Command1(1).Enabled = True
        frmWKL00.Command1(2).Enabled = True
        frmWKL00.Command1(3).Enabled = True
        frmWKL00.Command1(4).Enabled = True
        frmWKL00.Command1(8).Enabled = True
        
    End If
    
    'Datenbank auf lokale Datenbank setzen
    

'    gdBase.Close
    Set gdBase = Nothing
    gcDBPfad = "C:\aLeer"
    Set gdBase = OpenDatabase(gcDBPfad & "\kissdata.mdb", False)
    
    
    frmWKL00!Label2.Caption = "lokaler Modus - Anwender aktiv"
    frmWKL00!Label2.Refresh
    
    If gbLokalModus Then
'        'Datenbank Synchronisieren einstellen
'        ChkLM.Caption = "Datenbank synchronisieren"
'        ChkLM.Value = vbUnchecked
'        ChkLM.Visible = True
'        Command1(1).SetFocus
    End If
        
    Exit Sub
LOKAL_ERROR:
    Fehler.gsDescr = err.Description
    Fehler.gsNumber = err.Number
    Fehler.gsFormular = Me.name
    Fehler.gsFunktion = "schaltelokalmodus"
    Fehler.gsFehlertext = "Im Programmteil Datenbankfehler ist ein Fehler aufgetreten."
    
    Fehlermeldung1
End Sub
Private Sub Form_Load()
On Error GoTo LOKAL_ERROR

    Dim ctemp As String
    
    Screen.MousePointer = 11
    
    PositionierenWKL60
    Modul6.Skalieren Me, True, True

    
    frmWKL60.BackColor = &HC0FFFF
    Label2.BackColor = &HC0FFFF
    
    Command5(0).Enabled = True
    Command5(2).Enabled = False
    
    ctemp = gcUmleittxt
    
    schreibelokalFehlerproto "____________________________________"
    schreibelokalFehlerproto "Fehlernummer: " & CStr(giUmleitgrund) & vbCrLf & ctemp
    
    If giUmleitgrund = 0 Then
        lblUeberschrift.Caption = "Bitte Winkiss immer über die Schaltfläche 'Ende' beenden."
        lblUeberschrift.FontSize = 18
    Else
        lblUeberschrift.Caption = "Achtung! Fehler: " & giUmleitgrund
        lblUeberschrift.FontSize = 22
    End If
    
    anzeige "artikel", "", Label2
    anzeige "artikel", "", Label2
    anzeige "artikel", "", Label2
    anzeige "artikel", "", Label2
    anzeige "artikel", "", Label2
    
    
    Select Case giUmleitgrund
        Case 1

        Case 2 'Daba rep
            'ist lokal Daba vorbereitet?
            If FileExists("c:\aleer\kissdata.mdb") Then
                If notkassetabcheck Then
                    Command5(2).Enabled = True
                    ctemp = ctemp & "Drücken Sie 'Notfall Kasse'." & vbCrLf
                Else
                    Command5(2).Enabled = False
                    
                End If
            Else
                
                Command5(2).Enabled = False
            End If
            
            If FileExists(gcDBPfad & "\jetcomp.exe") Then
            
                Command5(0).Enabled = True
                Command5(0).Caption = "reparieren"
                Command5(0).BackColor = vbRed
            
            Else
                ctemp = ctemp & vbCrLf
                ctemp = ctemp & "Das Programm 'Jetcomp.exe' fehlt."
            
                Command5(0).Enabled = False
                Command5(0).Caption = "reparieren"
            End If
            
            
            If InStr(ctemp, "KASSBON.MDB") > 0 Then
            
                Command5(0).Enabled = False
                Command5(0).Caption = "reparieren"
            End If
            
            
            


        Case 3
            Command5(0).Enabled = False
            Command5(2).Enabled = False
            
        
        Case 4 'Unbekannter Fehler
            'schalte in lokalen Modus
            Command5(0).Enabled = False
            
            'ist lokal Daba vorbereitet?
            If FileExists("c:\aleer\kissdata.mdb") Then
                If notkassetabcheck Then
                    Command5(2).Enabled = True
                    ctemp = ctemp & "Drücken Sie 'Notfall Kasse'." & vbCrLf
                Else
                    Command5(2).Enabled = False
                    ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                End If
            Else
                ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                Command5(2).Enabled = False
            End If
        Case 8 'Unbekannte ocx 429
            'schalte in lokalen Modus
            Command5(0).Enabled = False
            
            'ist lokal Daba vorbereitet?
            If FileExists("c:\aleer\kissdata.mdb") Then
                If notkassetabcheck Then
                    Command5(2).Enabled = True
                    ctemp = ctemp & "Drücken Sie 'Notfall Kasse'." & vbCrLf
                Else
                    Command5(2).Enabled = False
                    ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                End If
            Else
                ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                Command5(2).Enabled = False
            End If
            
            
            
            
            
            
        Case 5 'Komprimierungs Fehler
            'schalte in lokalen Modus
            Command5(0).Enabled = False
            
            'ist lokal Daba vorbereitet?
            If FileExists("c:\aleer\kissdata.mdb") Then
                If notkassetabcheck Then
                    Command5(2).Enabled = True
                    ctemp = ctemp & "Drücken Sie 'Notfall Kasse'." & vbCrLf
                Else
                    Command5(2).Enabled = False
                    ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                End If
            Else
                ctemp = ctemp & "Drücken Sie 'Winkiss Beenden'." & vbCrLf
                Command5(2).Enabled = False
            End If
            
        Case 6 'DBEINSTE wird nicht gefunden Dabaversion kann nicht ausgelesen werden
            Command5(2).Enabled = False
    End Select
    
    
    Label1.BackColor = &HC0FFFF
    Label1.Caption = ctemp
    Label1.Refresh
    
    
    
    
    
    
    
    
    
    Label3.BackColor = &HC0FFFF
    Label3.Caption = ""
    Label3.Refresh
    Screen.MousePointer = 0
    
    Exit Sub
LOKAL_ERROR:
    Fehler.gsDescr = err.Description
    Fehler.gsNumber = err.Number
    Fehler.gsFormular = Me.name
    Fehler.gsFunktion = "Form_Load"
    Fehler.gsFehlertext = "Im Programmteil Datenbankfehler ist ein Fehler aufgetreten."
    
    Fehlermeldung1
End Sub

Private Sub PositionierenWKL60()
On Error GoTo LOKAL_ERROR
    
    
    
    
    Exit Sub
LOKAL_ERROR:
    Fehler.gsDescr = err.Description
    Fehler.gsNumber = err.Number
    Fehler.gsFormular = Me.name
    Fehler.gsFunktion = "PositionierenWKL60"
    Fehler.gsFehlertext = "Im Programmteil Datenbankfehler ist ein Fehler aufgetreten."
    
    Fehlermeldung1
End Sub

Private Sub Form_Unload(Cancel As Integer)
On Error GoTo LOKAL_ERROR
    
    LogtoEnd Me
    giUmleitgrund = 60
    
    
    Exit Sub
LOKAL_ERROR:
    Fehler.gsDescr = err.Description
    Fehler.gsNumber = err.Number
    Fehler.gsFormular = Me.name
    Fehler.gsFunktion = "Form_Unload"
    Fehler.gsFehlertext = "Im Programmteil Datenbankfehler ist ein Fehler aufgetreten."
    
    Fehlermeldung1
    
End Sub


